{% extends "student/result/base.html" %}
{% load static %}
{% block title %}Semester Result{% endblock title %}

{% block style %}
    <link rel="stylesheet" href= "{% static 'css/student/sem.css' %}" >
{% endblock style %}

{% block user-name %}{{student.name}}{% endblock user-name %}

{% block main-content %}
<div class="main-content">
    <div class="cgpa">
        <h2 class="bold" id="cgpa"></h2>
    </div>
    {% for semester in semesters_data %}
        <div class="semester">
            <h1 class="bold">Semester {{forloop.counter}}</h1>
            <div class="table-container">
                <table>
                    <tr>
                        <th>
                            Subject-Code
                        </th>
                        <th>
                            Subject-Title
                        </th>
                        <th>
                            Credits
                        </th>
                        <th>
                            Grade
                        </th>
                        <th>
                            Grade-Points
                        </th>
                    </tr>
                    {% for result in semester %}
                    <tr>
                        <td>{{result.exam.subject.code}}</td>
                        <td>{{result.exam.subject.name}}</td>
                        <td>{{result.exam.subject.credit}}</td>
                        <td>{{result.grade}}</td>
                        <td>{{result.grade_points}}</td>
                    </tr>
                    {% endfor %}
                    <tr>
                        <td colspan="4" class="bold">Grade Point Average-GPA</td>
                        <td id="semester{{forloop.counter}}"></td>
                    </tr>
                </table>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock main-content %}

{% block js %}
<script>
    var footer_node = document.getElementById("footer")
    var active_node = footer_node.getElementsByClassName("active")[0]
    active_node.classList.remove("active")
    var semester = document.getElementById("semester")
    semester.classList.add("active")


    var total_grade_points = 0;
    var scored_grade_points = 0;
    {% for semester in semesters_data %}
        {% if semester %}
            var sem_total_grade_points = 0;
            var sem_scored_grade_points = 0;
            {% for result in semester %}
                var _grade_points = "{{result.grade_points}}";
                var _credit = "{{result.exam.subject.credit}}";
                sem_total_grade_points += parseInt(_credit);
                sem_scored_grade_points += _credit*_grade_points;
                total_grade_points += parseInt(_credit);
                scored_grade_points += _credit*_grade_points;
            {% endfor %}
            var gpa = (sem_scored_grade_points/sem_total_grade_points).toFixed(3);
            var gpa_td = document.getElementById("semester{{forloop.counter}}");
            gpa_td.innerText = gpa;
        {% endif %}
    {% endfor %}
    var cgpa = (scored_grade_points/total_grade_points).toFixed(3);
    var cgpa_element = document.getElementById("cgpa");
    cgpa_element.innerText = "CGPA : " + cgpa;
</script>
{% endblock js %}